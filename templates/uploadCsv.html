<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Upload CSV and Train Model</title>
    <!-- Include the full version of jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Bootstrap CSS for styling (optional) -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <h2>Upload CSV and Train Model</h2>
        <!-- The form action should match the Flask route -->
        <form id="uploadForm" action="/uploadCsv" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="dataset">Upload Dataset:</label>
                <input type="file" class="form-control-file" id="dataset" name="dataset" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload and Train</button>
        </form>
        <br>
        <!-- Initially hidden progress bar -->
        <div class="progress" style="display: none;">
            <div class="progress-bar" role="progressbar" style="width: 0%;" id="progressBar">
                0%
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#uploadForm').submit(function (event) {
                event.preventDefault(); // Prevent the default form submission
                var formData = new FormData($(this)[0]);
                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: formData,
                    async: true,
                    beforeSend: function () {
                        // Show the progress bar on form submission
                        $('.progress').show();
                    },
                    success: function (data) {
                        console.log(data);
                        checkProgress();
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });

            function checkProgress() {
                var interval = setInterval(function () {
                    // Fetch the progress
                    $.get('/progress', function (data) {
                        // Update the progress bar width directly
                        $('#progressBar').css('width', data.progress + '%').text(data.progress + '%');

                        // Check if the training is complete
                        if (data.progress >= 100) {
                            clearInterval(interval);
                            // Hide the progress bar
                            $('.progress').hide();

                            // Create a Bootstrap alert element
                            var alert = $('<div class="alert alert-success alert-dismissible fade show" role="alert">' +
                                'Training and testing completed successfully!' +
                                '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                                '<span aria-hidden="true">Ã—</span>' +
                                '</button>' +
                                '</div>');

                            // Append the alert to a container, e.g., the body or a specific div
                            $('form').prepend(alert);
                        }
                    });
                }, 1000);
            }


        });
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>

</html>